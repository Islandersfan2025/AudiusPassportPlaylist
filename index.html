<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banshee Passports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #858fde; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .player-card { border-radius: 20px; border: none; overflow: hidden; max-width: 450px; width: 100%; }
        .logo-container { text-align: center; margin-bottom: 15px; }
        .logo-container img { max-width: 180px; }
        .track-item { cursor: pointer; transition: 0.2s; border-bottom: 1px solid #f0f0f0; }
        .track-item:hover { background-color: #858fde; }
        .active-track { background-color: #e1f5fe !important; border-left: 5px solid #0288d1; }
        .scrollable-list { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <div class="logo-container">
        <img src="image/bansheeLogo.png" alt="Banshee Music">
    </div>

    <div class="card player-card shadow-lg">
        <div class="card-header bg-white py-3 text-center border-0">
            <h5 class="text-primary fw-bold mb-0">Artist Passport- Pete Myers</h5>
        </div>
        
        <div id="playlist-container" class="list-group list-group-flush scrollable-list">
            <div class="p-5 text-center text-muted">Connecting to Audius nodes...</div>
        </div>

        <div class="card-footer bg-light p-4 border-0">
            <div id="now-playing-info" class="text-center mb-3">
                <div id="track-title" class="fw-bold text-dark">Select a Song</div>
                <div id="track-artist" class="small text-muted">to start playing</div>
            </div>
            <audio id="audio-player" controls class="w-100"></audio>
        </div>
    </div>
</div>

<script>
    const APP_NAME = "BansheeMusicPlayer";
    const PLAYLIST_ID = "D7KyD"; // Example Playlist ID
    let tracks = [];
    let currentIndex = 0;

    async function initPlayer() {
        try {
            // 1. Get an active discovery node automatically
            const hostResponse = await fetch('https://api.audius.co');
            const hostData = await hostResponse.json();
            const host = hostData.data[0]; // Pick the first available node

            // 2. Fetch tracks from the playlist using REST API
            const playlistUrl = `${host}/v1/playlists/${PLAYLIST_ID}/tracks?app_name=${APP_NAME}`;
            const trackResponse = await fetch(playlistUrl);
            const trackData = await trackResponse.json();
            tracks = trackData.data.slice(0, 3); // Take the first 3 songs

            renderPlaylist();
        } catch (err) {
            document.getElementById('playlist-container').innerHTML = `<div class="p-3 text-danger">Error loading playlist: ${err.message}</div>`;
        }
    }

    function renderPlaylist() {
        const container = document.getElementById('playlist-container');
        container.innerHTML = '';

        tracks.forEach((track, index) => {
            const item = document.createElement('div');
            item.className = `list-group-item track-item d-flex align-items-center p-3`;
            item.id = `track-${index}`;
            item.innerHTML = `
                <img src="${track.artwork['150x150']}" width="50" class="rounded me-3">
                <div class="text-truncate">
                    <div class="fw-bold mb-0">${track.title}</div>
                    <small class="text-muted">${track.user.name}</small>
                </div>
            `;
            item.onclick = () => playTrack(index);
            container.appendChild(item);
        });
    }

    function playTrack(index) {
        currentIndex = index;
        const track = tracks[index];
        const player = document.getElementById('audio-player');

        // Update Active UI
        document.querySelectorAll('.track-item').forEach(el => el.classList.remove('active-track'));
        document.getElementById(`track-${index}`).classList.add('active-track');

        // Set Metadata
        document.getElementById('track-title').innerText = track.title;
        document.getElementById('track-artist').innerText = `by ${track.user.name}`;

        // Get Stream URL (Points to the discovery node)
        // We fetch the host again or use the one we found
        const streamUrl = `https://discoveryprovider.audius.co/v1/tracks/${track.id}/stream?app_name=${APP_NAME}`;
        player.src = streamUrl;
        player.play();

        // Auto-play logic
        player.onended = () => {
            if (currentIndex < tracks.length - 1) playTrack(currentIndex + 1);
        };
    }

    initPlayer();
</script>

</body>

</html>
